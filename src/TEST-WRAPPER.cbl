>>SOURCE FORMAT FREE
IDENTIFICATION DIVISION.
PROGRAM-ID. TEST-WRAPPER.

ENVIRONMENT DIVISION.
INPUT-OUTPUT SECTION.
FILE-CONTROL.
    SELECT INFILE ASSIGN TO 'db2_in.dat'
        ORGANIZATION IS LINE SEQUENTIAL.
    SELECT OUTFILE ASSIGN TO 'db2_out.dat'
        ORGANIZATION IS LINE SEQUENTIAL.

DATA DIVISION.
FILE SECTION.
FD  INFILE.
01  IN-REC.
    05 IN-CUST-ID   PIC X(10).
    05 IN-NAME      PIC X(30).
    05 IN-BALANCE   PIC S9(7)V99 DISPLAY SIGN LEADING SEPARATE.
FD  OUTFILE.
01  OUT-REC.
    05 OUT-CUST-ID  PIC X(10).
    05 OUT-NAME     PIC X(30).
    05 OUT-BALANCE  PIC S9(7)V99 DISPLAY SIGN LEADING SEPARATE.
    05 OUT-STATUS   PIC X(10).
    05 OUT-SEGMENT  PIC X(10).

WORKING-STORAGE SECTION.
01  WS-EOF       PIC 9 VALUE 0.
01  WS-CUST-ID   PIC X(10).
01  WS-NAME      PIC X(30).
01  WS-BALANCE   PIC S9(7)V99 DISPLAY SIGN LEADING SEPARATE.
01  WS-STATUS    PIC X(10).
01  WS-SEGMENT   PIC X(10).

PROCEDURE DIVISION.
    OPEN INPUT INFILE
    OPEN OUTPUT OUTFILE

    PERFORM UNTIL WS-EOF = 1
        READ INFILE
            AT END
                MOVE 1 TO WS-EOF
                EXIT PERFORM
        END-READ

        MOVE IN-CUST-ID TO WS-CUST-ID
        MOVE IN-NAME    TO WS-NAME
        MOVE IN-BALANCE TO WS-BALANCE

        CALL 'CUSTPROC' USING WS-CUST-ID WS-NAME WS-BALANCE
                              WS-STATUS WS-SEGMENT

        MOVE WS-CUST-ID TO OUT-CUST-ID
        MOVE WS-NAME    TO OUT-NAME
        MOVE WS-BALANCE TO OUT-BALANCE
        MOVE WS-STATUS  TO OUT-STATUS
        MOVE WS-SEGMENT TO OUT-SEGMENT

        WRITE OUT-REC

        DISPLAY '{"cust_id":"' WS-CUST-ID
                '","name":"' WS-NAME
                '","balance":"' WS-BALANCE
                '","status":"' WS-STATUS
                '","segment":"' WS-SEGMENT '"}'
    END-PERFORM

    CLOSE INFILE
    CLOSE OUTFILE
    STOP RUN.
